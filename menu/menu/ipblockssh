#!/usr/bin/env bash
# list-sshd-blocked.sh
# Menampilkan hanya IP yang terblokir oleh Fail2Ban (jail sshd)

# Ambil baris yang berisi "Banned IP list"
banned_line=$(fail2ban-client status sshd 2>/dev/null \
  | grep "Banned IP list")

# Ambil bagian setelah tanda ":"
ips=$(echo "$banned_line" | cut -d: -f2-)

# Pecah jadi baris per IP
ips=$(echo "$ips" | tr ' ' '\n' | sed '/^$/d')

if [[ -n "$ips" ]]; then
  echo "=== Daftar IP Terblokir (sshd) ==="
  # Tampilkan dengan format kolom rapi
  echo "$ips" | awk '{printf " %-15s\n", $1}'
  echo
  count=$(echo "$ips" | wc -l)
  echo "Jumlah IP terblokir: $count"
else
  echo "Tidak ada IP terblokir"
fi